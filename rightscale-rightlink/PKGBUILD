# Maintainer: Brian Szmyd <brian.szmyd@rightscale.com>
# Contributor: Chris Fordham <chris.fordham@rightscale.com>

pkgname=rightscale-rightlink
pkgver=5.8.13
pkgrel=1
pkgdesc='RightScale RightLink cloud instance agent.'
arch=(i686 x86_64)
url=http://rightscale.com/
license=(MIT RUBY)
depends=(rightscal)
makedepends=(autoconf git tar)
conflicts=(rightscale-deb)
options=(emptydirs strip !docs !libtool !staticlibs)

_gitname=right_link
_rl_prefix="/opt/rightscale"

source=(
	"${_gitname}::git://github.com/rightscale/right_link.git"
	LICENSE
	system_configurator.rb.patch)
	
md5sums=('SKIP'
         '163c5dac82ec5a27cdfff253d688f405'
         '7238b0ca32d90a3d35406b4236f90fd7')		 # generate with 'makepkg -g'

package() {
	mkdir -p ${pkgdir}/${_rl_prefix}/right_link
	
	msg 'Installing RightLink into package...'
	pushd ${srcdir}/$_gitname
		git archive --format=tar v${pkgver} | tar -C ${pkgdir}/${_rl_prefix}/${_gitname} -x
	popd

	cd "$pkgdir"
	msg "Applying patch for system_configurator.rb..."
	patch -p0 < "$startdir/system_configurator.rb.patch"

	msg 'Adding LICENSE to package...'
	install -D "$startdir/LICENSE" "$pkgdir/usr/share/rightscale-rightlink/LICENSE"
}

# vim:syntax=sh